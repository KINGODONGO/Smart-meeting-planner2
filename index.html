<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Meeting Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            min-height: 100vh;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            color: #333;
            padding: 20px;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode {
            color: #e0e0e0;
        }

        body.dark-mode .container {
            background: rgba(30, 30, 40, 0.95);
        }

        body.dark-mode input, 
        body.dark-mode select,
        body.dark-mode button {
            background: rgba(50, 50, 60, 0.8);
            color: #e0e0e0;
            border-color: #555;
        }

        body.dark-mode .participant-card {
            background: rgba(50, 50, 60, 0.6);
            border-color: #555;
        }

        body.dark-mode .suggestion-card {
            background: rgba(50, 50, 60, 0.8);
            border-color: #555;
        }

        body.dark-mode .timeline {
            background: rgba(50, 50, 60, 0.4);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-controls {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }

        .theme-toggle {
            background: rgba(0, 0, 0, 0.1);
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.2em;
            transition: transform 0.2s;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #667eea;
        }

        body.dark-mode .section-title {
            color: #9f7aea;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .participant-card {
            background: rgba(240, 240, 250, 0.6);
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .participant-card input,
        .participant-card select {
            flex: 1;
            min-width: 150px;
        }

        .remove-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 8px 16px;
            font-size: 0.9em;
        }

        .add-participant-btn {
            width: 100%;
            margin-top: 10px;
        }

        .meeting-settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .find-times-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            margin-top: 20px;
        }

        .results {
            display: none;
        }

        .results.show {
            display: block;
        }

        .suggestion-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .suggestion-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .suggestion-card.best {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .score-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .time-info {
            margin: 15px 0;
        }

        .participant-time {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .conflict {
            color: #f5576c;
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .action-buttons button {
            flex: 1;
            min-width: 120px;
        }

        .timeline {
            background: rgba(240, 240, 250, 0.4);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .timeline-hours {
            display: flex;
            gap: 2px;
            min-width: 600px;
        }

        .hour-block {
            flex: 1;
            height: 60px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .hour-block:hover {
            transform: scale(1.05);
        }

        .hour-optimal {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: #333;
        }

        .hour-good {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
        }

        .hour-poor {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #333;
        }

        .hour-conflict {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #fff;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .participant-card {
                flex-direction: column;
            }

            .participant-card input,
            .participant-card select {
                width: 100%;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-buttons button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-controls">
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">üåô</button>
        </div>

        <h1>üåç Smart Meeting Planner</h1>

        <div class="section">
            <h2 class="section-title">üë• Participants</h2>
            <div id="participants">
                <div class="participant-card">
                    <input type="text" placeholder="Name" class="participant-name" value="John" aria-label="Participant name">
                    <select class="participant-tz" aria-label="Time zone">
                        <option value="America/New_York">EST (New York)</option>
                        <option value="America/Chicago">CST (Chicago)</option>
                        <option value="America/Denver">MST (Denver)</option>
                        <option value="America/Los_Angeles">PST (Los Angeles)</option>
                        <option value="Europe/London">GMT (London)</option>
                        <option value="Europe/Paris">CET (Paris)</option>
                        <option value="Asia/Dubai">GST (Dubai)</option>
                        <option value="Asia/Tokyo">JST (Tokyo)</option>
                        <option value="Asia/Shanghai">CST (Shanghai)</option>
                        <option value="Australia/Sydney">AEDT (Sydney)</option>
                    </select>
                    <button class="remove-btn" onclick="removeParticipant(this)">Remove</button>
                </div>
            </div>
            <button class="add-participant-btn" onclick="addParticipant()">+ Add Participant</button>
        </div>

        <div class="section">
            <h2 class="section-title">‚öôÔ∏è Meeting Settings</h2>
            <div class="meeting-settings">
                <div class="input-group">
                    <label for="start-time">Start Time Window</label>
                    <input type="time" id="start-time" value="09:00" aria-label="Meeting window start time">
                </div>
                <div class="input-group">
                    <label for="end-time">End Time Window</label>
                    <input type="time" id="end-time" value="17:00" aria-label="Meeting window end time">
                </div>
                <div class="input-group">
                    <label for="duration">Duration (minutes)</label>
                    <input type="number" id="duration" value="60" min="15" step="15" aria-label="Meeting duration">
                </div>
            </div>
            <button class="find-times-btn" onclick="findMeetingTimes()">üîç Find Best Meeting Times</button>
        </div>

        <div class="results" id="results">
            <div class="section">
                <h2 class="section-title">üìä Visual Timeline</h2>
                <div class="timeline" id="timeline"></div>
            </div>

            <div class="section">
                <h2 class="section-title">‚≠ê Suggested Meeting Times</h2>
                <div id="suggestions"></div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script type="text/javascript">
        atOptions = {
            'key' : '5ed71b9c5eb9dd8df0ef651bad7ecdfc',
            'format' : 'iframe',
            'height' : 90,
            'width' : 728,
            'params' : {}
        };
    </script>
    <script type="text/javascript" src="//www.highperformanceformat.com/5ed71b9c5eb9dd8df0ef651bad7ecdfc/invoke.js"></script>

    <script>(function(s){s.dataset.zone='10193375',s.src='https://groleegni.net/vignette.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>

    <script>
        let darkMode = false;

        function toggleTheme() {
            darkMode = !darkMode;
            document.body.classList.toggle('dark-mode');
            document.querySelector('.theme-toggle').textContent = darkMode ? '‚òÄÔ∏è' : 'üåô';
        }

        function addParticipant() {
            const container = document.getElementById('participants');
            const card = document.createElement('div');
            card.className = 'participant-card';
            card.innerHTML = `
                <input type="text" placeholder="Name" class="participant-name" aria-label="Participant name">
                <select class="participant-tz" aria-label="Time zone">
                    <option value="America/New_York">EST (New York)</option>
                    <option value="America/Chicago">CST (Chicago)</option>
                    <option value="America/Denver">MST (Denver)</option>
                    <option value="America/Los_Angeles">PST (Los Angeles)</option>
                    <option value="Europe/London">GMT (London)</option>
                    <option value="Europe/Paris">CET (Paris)</option>
                    <option value="Asia/Dubai">GST (Dubai)</option>
                    <option value="Asia/Tokyo">JST (Tokyo)</option>
                    <option value="Asia/Shanghai">CST (Shanghai)</option>
                    <option value="Australia/Sydney">AEDT (Sydney)</option>
                </select>
                <button class="remove-btn" onclick="removeParticipant(this)">Remove</button>
            `;
            container.appendChild(card);
        }

        function removeParticipant(btn) {
            const cards = document.querySelectorAll('.participant-card');
            if (cards.length > 1) {
                btn.parentElement.remove();
            } else {
                showToast('At least one participant is required');
            }
        }

        function getParticipants() {
            const cards = document.querySelectorAll('.participant-card');
            const participants = [];
            cards.forEach(card => {
                const name = card.querySelector('.participant-name').value || 'Unnamed';
                const tz = card.querySelector('.participant-tz').value;
                participants.push({ name, tz });
            });
            return participants;
        }

        function convertToTimezone(hour, fromTz, toTz) {
            const date = new Date();
            date.setHours(hour, 0, 0, 0);
            
            // Create a date string in the source timezone
            const dateStr = date.toLocaleString('en-US', { timeZone: fromTz });
            const sourceDate = new Date(dateStr);
            
            // Convert to target timezone
            const targetStr = sourceDate.toLocaleString('en-US', { 
                timeZone: toTz,
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });
            
            return parseInt(targetStr.split(':')[0]);
        }

        function isWorkingHours(hour) {
            return hour >= 8 && hour <= 18;
        }

        function calculateScore(hour, participants, baseTz) {
            let score = 100;
            let conflicts = [];

            participants.forEach(p => {
                const localHour = convertToTimezone(hour, baseTz, p.tz);
                
                if (localHour < 6 || localHour > 22) {
                    score -= 50;
                    conflicts.push(`${p.name}: ${formatHour(localHour)} (Night time)`);
                } else if (!isWorkingHours(localHour)) {
                    score -= 25;
                    conflicts.push(`${p.name}: ${formatHour(localHour)} (Outside work hours)`);
                } else if (localHour >= 12 && localHour <= 13) {
                    score -= 10;
                    conflicts.push(`${p.name}: ${formatHour(localHour)} (Lunch time)`);
                }
            });

            return { score: Math.max(0, score), conflicts };
        }

        function formatHour(hour) {
            const h = hour % 24;
            const period = h >= 12 ? 'PM' : 'AM';
            const displayHour = h === 0 ? 12 : h > 12 ? h - 12 : h;
            return `${displayHour}:00 ${period}`;
        }

        function findMeetingTimes() {
            const participants = getParticipants();
            const startTime = parseInt(document.getElementById('start-time').value.split(':')[0]);
            const endTime = parseInt(document.getElementById('end-time').value.split(':')[0]);
            const duration = parseInt(document.getElementById('duration').value);

            if (participants.length === 0) {
                showToast('Please add at least one participant');
                return;
            }

            const baseTz = participants[0].tz;
            const suggestions = [];

            // Generate timeline
            const timeline = document.getElementById('timeline');
            timeline.innerHTML = '<div class="timeline-hours"></div>';
            const hoursContainer = timeline.querySelector('.timeline-hours');

            for (let hour = startTime; hour < endTime; hour++) {
                const { score } = calculateScore(hour, participants, baseTz);
                const hourBlock = document.createElement('div');
                hourBlock.className = 'hour-block';
                hourBlock.textContent = formatHour(hour);
                
                if (score >= 90) hourBlock.classList.add('hour-optimal');
                else if (score >= 70) hourBlock.classList.add('hour-good');
                else if (score >= 50) hourBlock.classList.add('hour-poor');
                else hourBlock.classList.add('hour-conflict');
                
                hoursContainer.appendChild(hourBlock);

                if (score >= 50) {
                    suggestions.push({ hour, score, baseTz, participants });
                }
            }

            suggestions.sort((a, b) => b.score - a.score);

            // Display suggestions
            const suggestionsContainer = document.getElementById('suggestions');
            suggestionsContainer.innerHTML = '';

            suggestions.slice(0, 5).forEach((suggestion, index) => {
                const card = createSuggestionCard(suggestion, index === 0);
                suggestionsContainer.appendChild(card);
            });

            document.getElementById('results').classList.add('show');
            showToast('Found ' + suggestions.length + ' suitable time slots!');
        }

        function createSuggestionCard(suggestion, isBest) {
            const { hour, score, baseTz, participants } = suggestion;
            const card = document.createElement('div');
            card.className = 'suggestion-card' + (isBest ? ' best' : '');

            const { conflicts } = calculateScore(hour, participants, baseTz);

            let html = `
                <span class="score-badge">${isBest ? '‚≠ê Best Match - ' : ''}Score: ${score}/100</span>
                <h3>${formatHour(hour)} ${baseTz.split('/')[1]}</h3>
                <div class="time-info">
            `;

            participants.forEach(p => {
                const localHour = convertToTimezone(hour, baseTz, p.tz);
                const isConflict = localHour < 6 || localHour > 22 || !isWorkingHours(localHour);
                html += `
                    <div class="participant-time">
                        <span>${p.name}</span>
                        <span class="${isConflict ? 'conflict' : ''}">${formatHour(localHour)} (${p.tz.split('/')[1]})</span>
                    </div>
                `;
            });

            html += `</div>`;

            if (conflicts.length > 0) {
                html += `<div style="margin-top: 10px; color: #f5576c;">‚ö†Ô∏è ${conflicts.join(', ')}</div>`;
            }

            html += `
                <div class="action-buttons">
                    <button onclick='copyInvite(${JSON.stringify(suggestion)})'>üìã Copy Invite</button>
                    <button onclick='exportICS(${JSON.stringify(suggestion)})'>üìÖ Export .ics</button>
                </div>
            `;

            card.innerHTML = html;
            return card;
        }

        function copyInvite(suggestion) {
            const { hour, baseTz, participants } = suggestion;
            const duration = document.getElementById('duration').value;
            
            let invite = `Meeting Invitation
Time: ${formatHour(hour)} ${baseTz.split('/')[1]}
Duration: ${duration} minutes

Attendee Local Times:
`;

            participants.forEach(p => {
                const localHour = convertToTimezone(hour, baseTz, p.tz);
                invite += `${p.name}: ${formatHour(localHour)} (${p.tz.split('/')[1]})\n`;
            });

            navigator.clipboard.writeText(invite).then(() => {
                showToast('‚úÖ Invite copied to clipboard!');
            });
        }

        function exportICS(suggestion) {
            const { hour, baseTz } = suggestion;
            const duration = document.getElementById('duration').value;
            const participants = getParticipants();
            
            const now = new Date();
            const startDate = new Date(now);
            startDate.setHours(hour, 0, 0, 0);
            startDate.setDate(now.getDate() + 1); // Tomorrow
            
            const endDate = new Date(startDate);
            endDate.setMinutes(endDate.getMinutes() + parseInt(duration));

            const ics = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Smart Meeting Planner//EN
BEGIN:VEVENT
UID:${Date.now()}@meetingplanner
DTSTAMP:${formatICSDate(now)}
DTSTART:${formatICSDate(startDate)}
DTEND:${formatICSDate(endDate)}
SUMMARY:Team Meeting
DESCRIPTION:Scheduled via Smart Meeting Planner\\nAttendees: ${participants.map(p => p.name).join(', ')}
END:VEVENT
END:VCALENDAR`;

            const blob = new Blob([ics], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'meeting.ics';
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('üìÖ Calendar file downloaded!');
        }

        function formatICSDate(date) {
            return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
